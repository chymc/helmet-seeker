
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
  
  <script>
    var odyc = (function (exports) {
    'use strict';

    var U=class{#x;#t;#i;position=[0,0];#e;#r;constructor(x){this.#e=x.screenWidth,this.#r=x.screenHeight,x.cameraWidth&&x.cameraHeight&&(this.#t=x.cameraWidth,this.#i=x.cameraHeight,this.#x={left:(x.screenWidth-this.#t)*.5,right:(x.screenWidth+this.#t)*.5-1,top:(x.screenHeight-this.#i)*.5,bottom:(x.screenHeight+this.#i)*.5-1});}update(x,e){let[t,r]=x;if(!this.#x||!this.#e||!this.#r){this.position[0]=Math.floor(t/this.#e)*this.#e,this.position[1]=Math.floor(r/this.#r)*this.#r,this.#s(e);return}let[s,o]=this.position,n=t-s,a=r-o;n<this.#x.left&&(this.position[0]-=this.#x.left-n),n>this.#x.right&&(this.position[0]+=n-this.#x.right),a<this.#x.top&&(this.position[1]-=this.#x.top-a),a>this.#x.bottom&&(this.position[1]+=a-this.#x.bottom),this.#s(e);}isOnScreen(x){let[e,t]=x,r=e-this.position[0],s=t-this.position[1];return r>=0&&s>=0&&r<this.#e&&s<this.#r}reset(){this.position=[0,0];}#s(x){let[e,t]=x;this.position[0]=Math.max(0,Math.min(this.position[0],e-this.#e)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.#r));}},t0=i=>new U(i);var i0={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",ACTION:["Enter","Space"]}};var b=i=>i.trim().replace(/[ \t]/gm,"").split(/\n+/gm),s0=i=>{let x=i.length;return [Math.max(...i.map(t=>t.length)),x]};var k=i=>{try{return new URL(i),!0}catch{return  false}},r0="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),u=(i,x)=>{if(i=`${i}`,i.length>1)return i;if(!r0.includes(i))return "transparent";let e=r0.findIndex(r=>r===i);return x[e]??"transparent"};var n0=(...i)=>i.reduce((x,e)=>[x[0]+e[0],x[1]+e[1]],[0,0]),y=(...i)=>!i.some((x,e)=>{let t=i[e-1];return t?t[0]!==x[0]||t[1]!==x[1]:false});var o0=(i,x)=>{let e;return (...t)=>{let r;return e&&clearTimeout(e),e=setTimeout(()=>{r=i(...t);},x),r}};function d(){let i=0,x=new Map;return {subscribe(e){let t=i++;return x.set(t,e),()=>x.delete(t)},notify(e){x.forEach(t=>t(e));},clear(){x.clear();}}}var L0=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],O0=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],U0=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],k0=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],W0=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],G0=[[0,4,8,127,3,63,3,127],[0,54,0,127,3,63,3,127],[0,31,6,62,102,102,102,54],[0,16,8,127,3,3,3,3],[0,62,99,3,15,3,99,62],[0,62,99,3,62,96,99,62],[0,126,24,24,24,24,24,126],[0,54,0,127,28,28,28,127],[0,120,96,96,96,99,99,62],[0,30,27,27,59,91,91,59],[0,27,27,27,63,91,91,59],[0,31,6,62,102,102,102,102],[0,16,8,99,51,31,51,99],[0,4,8,99,115,123,111,103],[0,20,8,99,54,60,24,15],[0,99,99,99,99,127,28,28],[0,28,54,99,99,127,99,99],[0,63,3,3,63,99,99,63],[0,63,99,99,63,99,99,63],[0,127,3,3,3,3,3,3],[0,62,54,54,54,54,127,99],[0,127,3,3,63,3,3,127],[0,107,107,62,28,62,107,107],[0,62,99,96,56,96,99,62],[0,99,115,123,107,111,103,99],[0,20,8,99,115,123,111,103],[0,99,51,27,15,27,51,99],[0,124,102,102,102,102,102,99],[0,99,119,127,107,99,99,99],[0,99,99,99,127,99,99,99],[0,62,99,99,99,99,99,62],[0,127,99,99,99,99,99,99],[0,63,99,99,63,3,3,3],[0,62,99,3,3,3,99,62],[0,126,24,24,24,24,24,24],[0,99,99,54,60,24,12,7],[0,8,62,107,107,107,62,8],[0,99,119,62,28,62,119,99],[0,51,51,51,51,51,127,96],[0,99,99,99,127,96,96,96],[0,107,107,107,107,107,107,127],[0,107,107,107,107,107,127,96],[0,7,6,62,102,102,102,62],[0,99,99,99,103,107,107,103],[0,3,3,3,63,99,99,63],[0,62,99,96,120,96,99,62],[0,57,109,109,111,109,109,57],[0,126,99,99,126,108,102,99],[0,0,0,62,96,126,99,126],[0,62,3,63,99,99,99,62],[0,0,0,63,99,63,99,63],[0,0,0,127,3,3,3,3],[0,0,0,62,54,54,127,99],[0,0,0,62,99,127,3,62],[0,0,0,107,107,62,107,107],[0,0,0,62,99,56,99,62],[0,0,0,99,115,123,111,103],[0,20,8,0,115,123,111,103],[0,0,0,99,51,31,51,99],[0,0,0,124,102,102,102,99],[0,0,0,99,119,127,107,99],[0,0,0,99,99,127,99,99],[0,0,0,62,99,99,99,62],[0,0,0,127,99,99,99,99],[0,0,0,63,99,63,3,3],[0,0,0,62,99,3,99,62],[0,0,0,126,24,24,24,24],[0,0,0,99,54,60,24,15],[0,0,8,62,107,107,62,8],[0,0,0,119,62,28,62,119],[0,0,0,51,51,51,127,96],[0,0,0,99,99,127,96,96],[0,0,0,107,107,107,107,127],[0,0,0,107,107,107,127,96],[0,0,0,7,6,62,102,62],[0,0,0,99,99,103,107,103],[0,0,0,3,3,63,99,63],[0,0,0,62,99,120,99,62],[0,0,0,57,109,111,109,57],[0,0,0,126,99,126,108,102],[0,4,8,62,99,127,3,62],[0,54,0,62,99,127,3,62],[0,15,6,62,102,102,102,48],[0,16,8,0,127,3,3,3],[0,0,0,62,99,15,99,62],[0,0,0,126,3,127,96,63],[0,24,0,30,24,24,24,127],[0,54,0,30,24,24,24,127],[0,96,0,96,96,96,99,62],[0,0,0,30,27,59,91,59],[0,0,0,27,27,63,91,59],[0,6,15,6,62,102,102,102],[0,16,8,0,99,51,31,115],[0,4,8,0,115,123,111,103],[0,20,8,0,54,60,24,15],[0,0,0,99,99,99,127,28],[0,54,65,65,93,73,62,20],[0,0,0,107,107,107,62,54],[0,4,31,4,60,100,100,60],[0,4,4,31,4,60,100,60],[0,51,91,27,63,27,91,51],[0,0,0,115,27,63,27,115],[0,8,28,54,99,127,107,107],[0,0,0,28,54,99,127,107],[0,17,57,109,69,127,85,85],[0,0,0,57,109,69,127,85],[0,127,99,54,8,62,107,107],[0,0,0,62,20,8,62,107],[0,125,69,41,17,63,85,85],[0,0,0,125,41,17,63,85],[0,99,115,51,51,51,30,12],[0,0,0,99,51,51,30,12],[0,99,115,51,51,51,30,12],[54,108,0,99,51,51,30,12],[0,62,99,3,3,30,24,24],[0,0,0,62,99,3,30,24],[0,64,104,48,90,12,22,2],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,6,15,6,62,102,102,62],[0,6,6,15,6,62,102,62],[0,63,99,107,63,19,3,3],[0,0,0,63,107,63,19,3],[0,64,127,3,3,3,3,3],[0,0,64,127,3,3,3,3],[0,126,6,6,31,6,6,6],[0,0,0,126,6,31,6,6],[0,63,3,63,99,99,96,63],[0,0,0,63,3,63,96,63],[0,107,62,28,62,107,107,64],[0,0,107,107,62,107,107,64],[0,62,99,56,99,62,8,12],[0,62,96,56,96,62,8,12],[0,115,27,15,27,51,99,64],[0,0,99,51,31,51,99,64],[0,97,53,29,15,29,53,97],[0,0,0,97,53,31,53,97],[0,98,55,26,14,26,50,98],[0,2,7,98,50,30,50,98],[0,103,54,30,14,30,54,102],[0,0,0,103,54,30,54,102],[0,51,51,63,51,51,115,64],[0,0,51,51,63,51,115,64],[0,115,51,51,63,51,51,51],[0,0,0,115,51,63,51,51],[0,15,9,57,73,73,73,32],[0,0,0,15,57,73,73,32],[0,38,81,81,81,81,33,94],[0,0,0,38,81,81,33,94],[0,62,99,3,99,62,8,12],[0,0,62,3,3,62,8,12],[0,126,24,24,24,24,56,32],[0,0,0,126,24,24,56,32],[0,102,102,102,60,24,24,24],[0,0,0,102,102,60,24,24],[0,99,99,99,54,28,127,28],[0,0,0,99,54,28,127,28],[0,119,62,28,62,119,99,64],[0,0,119,62,28,62,119,64],[0,47,34,34,34,34,126,64],[0,0,0,47,34,34,126,64],[0,51,51,63,48,48,112,64],[0,0,0,51,63,48,112,64],[0,99,107,107,127,104,104,96],[0,0,0,99,107,127,104,96],[0,3,3,63,99,99,99,99],[0,0,3,3,63,99,99,99],[0,56,108,109,127,12,76,56],[0,0,0,56,109,127,12,56],[0,56,108,109,127,12,56,16],[0,0,56,109,127,12,56,16],[0,126,24,24,24,24,24,126],[0,20,28,107,107,62,107,107],[0,20,28,0,107,62,107,107],[0,99,99,127,96,96,112,16],[0,0,0,99,127,96,112,16],[0,28,26,24,24,24,24,126],[0,20,28,28,54,99,127,99],[0,20,28,62,96,126,99,126],[0,54,0,28,54,99,127,99],[0,54,0,62,96,126,99,126],[0,124,30,27,123,31,27,123],[0,0,0,63,108,127,13,63],[0,20,28,127,3,31,3,127],[0,20,28,62,99,127,3,62],[0,30,51,96,127,99,54,28],[0,0,0,63,96,127,99,62],[0,30,51,96,127,99,54,28],[0,108,0,63,96,127,99,62],[0,54,0,107,107,62,107,107],[0,0,54,0,107,62,107,107],[0,62,99,96,56,96,99,62],[0,108,0,62,99,56,99,62],[0,63,48,24,56,99,99,62],[0,0,0,63,16,56,99,62],[0,62,0,99,115,123,111,103],[0,0,62,0,115,123,111,103],[0,54,0,99,115,123,111,103],[0,0,54,0,115,123,111,103],[0,54,0,62,99,99,99,62],[0,0,54,0,62,99,99,62],[0,62,99,99,127,99,99,62],[0,0,0,62,99,127,99,62],[0,62,99,99,127,99,99,62],[0,108,0,62,99,127,99,62],[0,62,99,96,120,96,99,62],[0,108,0,62,99,120,99,62],[0,62,0,99,54,60,24,15],[0,0,62,0,99,54,28,15],[0,54,0,99,54,60,24,15],[0,0,54,0,99,54,28,15],[0,20,20,99,54,60,24,15],[0,20,20,0,54,60,24,15],[0,54,0,99,99,127,96,96],[0,0,54,0,99,127,96,96],[0,127,3,3,3,3,7,4],[0,0,0,127,3,3,7,4],[0,99,99,99,103,107,107,103],[0,108,0,99,99,103,107,103]],a0=[{start:0,characters:L0},{start:160,characters:O0},{start:912,characters:U0},{start:12352,characters:k0},{start:9600,characters:W0},{start:1024,characters:G0}];var c0={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","\xB0":"blink"},C=8,g=class i{#x;#t;#i;#e;#r;constructor(x,e,t){this.#i=x,this.#e=e,this.#r=t,this.#x=[{pattern:"\\\\.",type:"char",process:r=>r.charAt(1)},{pattern:this.#c(x),type:"char"},{pattern:"<.>",type:"color",process:r=>r.charAt(1)},{pattern:Object.keys(c0).map(this.#c).join("|"),type:"effect",process:r=>c0[r]},{pattern:"[^\\n\\r\\t]",type:"char"}],this.#t=new RegExp(this.#x.map(r=>`(${r.pattern})`).join("|"),"g");}parseText(x,e){let t=this.#s(x),r=this.#n(t);return this.#o(r,e)}draw(x,e,t,r,s){for(let o=0;o<e.length;o++){let n=e[o];if(n===void 0)continue;let a=t+o*C,c=r,h=n.color?u(n.color,this.#r):null;switch(h?x.fillStyle=h:x.fillStyle=this.#e,n.effect){case "waveY":c+=Math.floor(Math.sin(s*.01+o)*3);break;case "waveX":a+=Math.floor(Math.sin(s*.01+o)*2);break;case "shake":a+=Math.floor((Math.random()-.5)*2),c+=Math.floor((Math.random()-.5)*2);break;case "shakeX":a+=Math.floor((Math.random()-.5)*2);break;case "shakeY":c+=Math.floor((Math.random()-.5)*2);break;case "blink":Math.sin(s*.015)>0&&(x.fillStyle="transparent");break}i.#a(x,n.value,a,c);}}#s(x){let e=x.matchAll(this.#t),t=[];for(let r of e){r.shift();let s=r.findIndex(c=>c!==void 0),{type:o,process:n}=this.#x[s],a=n?n(r[s]):r[s];t.push({value:a,type:o});}return t}#n(x){let e=[],t=[],r=[];for(let s=0;s<x.length;s++){let o=x[s];if(!o)continue;let{type:n,value:a}=o;if(n==="char"){let c=t[t.length-1],h=r[r.length-1];e.push({value:a,color:c,effect:h});continue}if(o.type==="color"){let c=t.lastIndexOf(a);c!==-1?t.splice(c,1):t.push(a);continue}if(o.type==="effect"){let c=r.lastIndexOf(a);c!==-1?r.splice(c,1):r.push(a);}}return e}#o(x,e){let t=[];x:for(;x.length>0;){let r=x.findIndex((s,o)=>s.value===this.#i&&o<e);if(r!==-1){t.push(x.splice(0,r)),x.splice(0,1);continue}else if(x.length<=e){t.push(x),x=[];continue}for(let s=e;s>=0;s--)if(x[s]?.value===" "){t.push(x.splice(0,s)),x.splice(0,1);continue x}t.push(x.splice(0,e));}return x.length>0&&t.push(x),t}#c(x){return x.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static#a(x,e,t,r){let s=e.charCodeAt(0),o=this.#l(s);if(o)for(let n=0;n<C;n++){let a=o[n];if(a!==void 0)for(let c=0;c<C;c++)a&1<<c&&x.fillRect(t+c,r+n,1,1);}}static text(x,e,t,r){for(let s=0;s<e.length;s++){let o=e.charAt(s);i.#a(x,o,t+s*C,r);}}static#l(x){let e=a0.find(t=>x>=t.start&&x<t.start+t.characters.length);return e?e.characters[x-e.start]:null}};var W=384,N0=30,T=2,h0=28,f0=10,l0=8,u0=12,H0=8,A=2,G=class{#x;#t;#i;#e;#r;#s=[];#n=0;#o;#c=0;#a;isOpen=false;#l;#f;#u;#m;#p;#h;#d;#g;#b;constructor(x){this.#l=x.colors,this.#f=u(x.dialogBackground,x.colors),this.#u=u(x.dialogColor,x.colors),this.#m=u(x.dialogBorder,x.colors),this.#p=x.dialogInternvalMs,this.#x=document.createElement("canvas"),this.#x.style.setProperty("position","absolute"),this.#x.style.setProperty("box-sizing","border-box"),this.#x.style.setProperty("display","none"),this.#x.style.setProperty("image-rendering","pixelated"),this.#t=this.#x.getContext("2d"),this.#x.width=W,this.#x.height=W,this.#x.classList.add("odyc-dialog-canvas"),this.#T(),document.body.append(this.#x),window.addEventListener("resize",this.#T),this.#d=h0*8+l0*2,this.#h=T*H0+u0*2+f0*(T-1),this.#g=(this.#x.width-this.#d)*.5,this.#b=this.#x.height-this.#h-Math.floor(W/15),this.#a=new g("|",this.#u,x.colors);}async open(x){if(!(x.length<=0))return this.isOpen=true,this.#x.style.setProperty("display","block"),this.#e=this.#a.parseText(x,h0),this.#r=this.#e.shift(),this.#s=new Array(T).fill(null).map(e=>[]),this.#o=requestAnimationFrame(this.#y),new Promise(e=>{this.#i=()=>e();})}next(){this.#r&&this.#r.length>0||this.#n<T-1||(this.#r=this.#e?.shift(),this.#n=0,this.#s=this.#s.map(()=>[]),this.#r===void 0&&this.#v());}#y=x=>{if(this.#o=requestAnimationFrame(this.#y),x-this.#c<(this.#p||N0))return;this.#c=x,this.#r?.length===0&&this.#n<T-1&&(this.#n++,this.#r=this.#e?.shift());let e=this.#r?.shift();e&&this.#s[this.#n]?.push(e),this.#P(x);};#v(){this.isOpen=false,this.#x.style.setProperty("display","none"),this.#n=0,this.#i?.(),this.#o&&cancelAnimationFrame(this.#o);}#T=()=>{let x=Math.min(window.innerWidth,window.innerHeight),e=(window.innerWidth-x)*.5,t=(window.innerHeight-x)*.5;this.#x.style.setProperty("width",`${x}px`),this.#x.style.setProperty("height",`${x}px`),this.#x.style.setProperty("left",`${e}px`),this.#x.style.setProperty("top",`${t}px`);};#P=x=>{this.#E();let e=this.#g+l0;for(let t=0;t<this.#s.length;t++){let r=this.#s[t];if(!r)continue;let s=this.#b+u0+8*t+t*f0;this.#a.draw(this.#t,r,e,s,x);}};#E(){this.#t.clearRect(0,0,this.#x.width,this.#x.height),this.#t.fillStyle=this.#m,this.#t.fillRect(this.#g-A,this.#b-A,this.#d+A*2,this.#h+A*2),this.#t.fillStyle=this.#f,this.#t.fillRect(this.#g,this.#b,this.#d,this.#h);}},m0=i=>new G(i);var p0=({gameState:i,messageBox:x,camera:e})=>{let t=false;return {play:async(...r)=>{r.length&&x.open(r),t=true,e.reset(),i.turn.reset(),i.player.restoreSavedState(),i.actors.initActors();},get ending(){return t},set ending(r){t=r;}}};var N=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`;var H=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`;var d0=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`;var g0=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`;var b0=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`;var B={fractal:{fragment:d0,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:g0,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:b0,settings:{scale:.75,intensity:.8}}},y0=i=>{if("name"in i){let x=Object.assign({},B[i.name].settings,i.settings);return {vertex:B[i.name].vertex??N,fragment:B[i.name].fragment??H,settings:x}}return {vertex:i.vertex??N,fragment:i.fragment??H,settings:i.settings}};var V=class{canvas;#x;#t={};#i;#e;#r;#s;#n;#o=new Map;#c;constructor(x,e){if(this.#x=y0(e),this.#x.settings)for(let o in this.#x.settings){let n=this.#x.settings?.[o];this.#t[o]=Array.isArray(n)?[...n]:n;}this.#i=x,this.canvas=document.createElement("canvas"),this.canvas.width=this.#i.width,this.canvas.height=this.#i.height,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-filter-canvas"),window.addEventListener("resize",this.#a);let t=this.canvas.getContext("webgl",{preserveDrawingBuffer:true});if(!t)throw new Error("WebGL not supported");this.#e=t;let r=this.#l(this.#e.VERTEX_SHADER,this.#x.vertex),s=this.#l(this.#e.FRAGMENT_SHADER,this.#x.fragment);this.#r=this.#f(r,s),this.#e.useProgram(this.#r),this.#c=this.#e.getAttribLocation(this.#r,"a_position"),this.#n=this.#u(),this.#s=this.#m(),this.#a(),this.#i.after(this.canvas),this.#i.style.setProperty("display","none");}render(){this.#d("size",[this.canvas.width,this.canvas.height]),this.#t&&Object.entries(this.#t).forEach(([x,e])=>{this.#d(x,e);}),this.#e.viewport(0,0,this.canvas.width,this.canvas.height),this.#e.clearColor(0,0,0,1),this.#e.clear(this.#e.COLOR_BUFFER_BIT),this.#p(),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,this.#n),this.#e.enableVertexAttribArray(this.#c),this.#e.vertexAttribPointer(this.#c,2,this.#e.FLOAT,false,0,0),this.#e.drawArrays(this.#e.TRIANGLES,0,6);}setUniforms(x){for(let[e,t]of Object.entries(x))this.#t[e]=Array.isArray(t)?[...t]:t;}#a=()=>{let x=this.canvas.width<this.canvas.height?"vertical":"horizontal",e=Math.min(window.innerWidth,window.innerHeight),t=x==="horizontal"?e:e/this.canvas.height*this.canvas.width,r=x==="vertical"?e:e/this.canvas.width*this.canvas.height,s=(window.innerWidth-t)*.5,o=(window.innerHeight-r)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${r}px`),this.canvas.style.setProperty("left",`${s}px`),this.canvas.style.setProperty("top",`${o}px`),this.render();};#l(x,e){let t=this.#e.createShader(x);if(this.#e.shaderSource(t,e),this.#e.compileShader(t),!this.#e.getShaderParameter(t,this.#e.COMPILE_STATUS)){let r=this.#e.getShaderInfoLog(t);throw this.#e.deleteShader(t),new Error(`Shader compilation failed:
${r}`)}return t}#f(x,e){let t=this.#e.createProgram();if(this.#e.attachShader(t,x),this.#e.attachShader(t,e),this.#e.linkProgram(t),!this.#e.getProgramParameter(t,this.#e.LINK_STATUS)){let r=this.#e.getProgramInfoLog(t);throw this.#e.deleteProgram(t),new Error(`Program link failed:
${r}`)}if(this.#e.validateProgram(t),!this.#e.getProgramParameter(t,this.#e.VALIDATE_STATUS))throw new Error("validating program"+this.#e.getProgramInfoLog(t));return t}#u(){let x=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),e=this.#e.createBuffer();if(this.#e.bindBuffer(this.#e.ARRAY_BUFFER,e),this.#e.bufferData(this.#e.ARRAY_BUFFER,x,this.#e.STATIC_DRAW),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,null),!e)throw new Error("failed to create quad");return e}#m(){let x=this.#e.createTexture();if(this.#e.bindTexture(this.#e.TEXTURE_2D,x),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_S,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_T,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MIN_FILTER,this.#e.NEAREST),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MAG_FILTER,this.#e.NEAREST),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i),this.#e.bindTexture(this.#e.TEXTURE_2D,null),!x)throw new Error("failed to create texture");return x}#p(){this.#e.bindTexture(this.#e.TEXTURE_2D,this.#s),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#i);}#h(x){let e=`u_${x}`;if(this.#o.has(e))return this.#o.get(e);let t=this.#e.getUniformLocation(this.#r,e);return t&&this.#o.set(e,t),t}#d(x,e){let t=this.#h(x);if(t){if(typeof e=="number"&&(e=[e]),e.length<1||e.length>4)throw new Error("setUniform supports 1\u20134 float values");switch(e.length){case 1:this.#e.uniform1f(t,e[0]);break;case 2:this.#e.uniform2f(t,e[0],e[1]);break;case 3:this.#e.uniform3f(t,e[0],e[1],e[2]);break;case 4:this.#e.uniform4f(t,e[0],e[1],e[2],e[3]);break}}}},v0=(i,x)=>x?new V(i,x):null;var T0=(i,x,e,t,r,s)=>({player:i.player.facade,getCell:(n,a)=>i.actors.getCell(n,a),addToCell:(n,a,c)=>i.actors.addToCell(n,a,c),setCell:(n,a,c)=>i.actors.setCell(n,a,c),getAll:n=>i.actors.getAll(n),setAll:(n,a)=>i.actors.setAll(n,a),openDialog:n=>x.open(n),prompt:(...n)=>e.open(...n),openMenu:n=>e.openMenu(n),openMessage:(...n)=>s.open(n),playSound:(...n)=>t.play(...n),end:(...n)=>r.play(...n),loadMap:(n,a)=>{a&&(i.player.position=[...a]),i.gameMap.map=n,i.player.saveCurrentState();},updateFilter:n=>{i.filterUniforms.set(n);},get width(){return i.gameMap.dimensions[0]},get height(){return i.gameMap.dimensions[1]},get turn(){return i.turn.value}});var X=class{#x;#t;#i;#e;constructor(x){this.#x=x.gameState,this.#t=x.soundPlayer,this.#i=x.dialog,this.#e=x.ender;}async update(x){this.#e.ending=false,this.#x.player.setDirection(x);let e=this.#x.player.position,t=n0(e,Y0[x]);if(this.#o(t)){let r=this.#x.actors.getCell(...t);r.solid||(await this.#x.actors.getEvent(...e,"onLeave")?.(),this.#x.player.position=t),this.#r(r),await this.#s(r),r.solid?await this.#x.actors.getEvent(...t,"onCollide")?.():await this.#x.actors.getEvent(...t,"onEnter")?.();}for(let r of this.#x.actors.get())await this.#x.actors.getEvent(...r.position,"onTurn")?.();this.#x.player.dispatchOnTurn(),this.#e.ending||this.#x.turn.next(),await this.#n(this.#x.actors.getCell(...t));}#r(x){let e=x.sound;if(e){let t=Array.isArray(e)?e:[e];this.#t.play(...t);}}async#s(x){x.dialog&&await this.#i.open(x.dialog);}async#n(x){let e=x.end;e&&(typeof e=="string"?await this.#e.play(e):typeof e=="boolean"&&e?this.#e.play():await this.#e.play(...e));}#o([x,e]){return x>=0&&e>=0&&x<this.#x.gameMap.dimensions[0]&&e<this.#x.gameMap.dimensions[1]}},Y0={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},P0=i=>new X(i);var P=class{#x;#t;constructor(x,e){this.#x=x,this.#t=e;}get sprite(){return this.#i()?.sprite??null}set sprite(x){this.#e("sprite",x);}get solid(){return this.#i()?.solid??false}set solid(x){this.#e("solid",x);}get sound(){return this.#i()?.sound??null}set sound(x){this.#e("sound",x);}get position(){return this.#i()?.position??[-1,-1]}get dialog(){return this.#i()?.dialog??null}set dialog(x){this.#e("dialog",x);}get visible(){return this.#i()?.visible??false}set visible(x){this.#e("visible",x);}get foreground(){return this.#i()?.foreground??false}set foreground(x){this.#e("foreground",x);}get end(){return this.#i()?.end??null}set end(x){this.#e("end",x);}get symbol(){return this.#i()?.symbol??null}get isOnScreen(){return this.#i()?.isOnScreen??false}remove(){this.#t.clearCell(...this.#x);}#i(){return this.#t.get().find(x=>y(x.position,this.#x))}#e(x,e){this.#t.setCell(...this.#x,{[x]:e});}};var I=class{#x=[];#t;#i;#e;constructor(x,e){this.#t=e,this.#i=x.templates,this.#e=d(),this.initActors(),e.subscribe(()=>this.initActors());}subscribe(x){this.#e.subscribe(x);}getAll(x){return this.#x.filter(e=>e.symbol===x).map(e=>new P(e.position,this))}setAll(x,e){for(let t=0;t<this.#x.length;t++){let r=this.#x[t];if(r?.symbol!==x)continue;let s=Object.assign({},r,e);this.#x[t]=s;}this.#e.notify();}setCell(x,e,t){for(let r=0;r<this.#x.length;r++){let s=this.#x[r];if(s&&s.position&&y(s.position,[x,e])){let o=Object.assign({},s,t);this.#x[r]=o;break}}this.#e.notify();}addToCell(x,e,t){let r=this.#n(this.#i,t);r&&(this.#x=[...this.#x.filter(s=>!y([x,e],s.position)),this.#s(x,e,t,r)],this.#e.notify());}getCell(x,e){return new P([x,e],this)}clearCell(x,e){this.#x=this.#x.filter(t=>!y(t.position,[x,e])),this.#e.notify();}getEvent(x,e,t){let r=this.#x.find(s=>s.position[0]===x&&s.position[1]===e)?.[t];if(r)return ()=>r(this.getCell(x,e))}get(){return this.#x}handleScreenEvents(x){let e=[],t=[];for(let r=0;r<this.#x.length;r++){let s=this.#x[r];if(!s)continue;let o=x.isOnScreen(s.position);s.isOnScreen!==o&&(this.#x[r].isOnScreen=o,o?t.push(this.getEvent(...s.position,"onScreenEnter")):e.push(this.getEvent(...s.position,"onScreenLeave")));}e.forEach(r=>{r&&r();}),t.forEach(r=>{r&&r();});}initActors(){this.#x=this.#r(b(this.#t.map),this.#i);}#r(x,e){let t=[];for(let r=0;r<x.length;r++){let s=x[r];if(s)for(let o=0;o<s.length;o++){let n=s[o];if(!n)continue;let a=this.#n(e,n);a&&t.push(this.#s(o,r,n,a));}}return t}#s(x,e,t,r){return {symbol:t,sprite:r.sprite??null,position:[x,e],dialog:r.dialog??null,isOnScreen:false,end:r.end??null,sound:r.sound??null,solid:r.solid!==false,visible:r.visible!==false,foreground:r.foreground!==false,onCollide:r.onCollide,onEnter:r.onEnter,onLeave:r.onLeave,onScreenEnter:r.onScreenEnter,onScreenLeave:r.onScreenLeave,onTurn:r.onTurn}}#n(x,e){let t=x[e];if(t)return typeof t=="function"?t():t}};var M=class{#x;#t;constructor(x){this.#x=this.#i(x),this.#t=d();}subscribe(x){this.#t.subscribe(x);}get(){return this.#i(this.#x)}set(x){for(let[e,t]of Object.entries(x))this.#x[e]=Array.isArray(t)?[...t]:t;this.#t.notify();}#i(x){let e={};for(let t in x){let r=x[t];r!==void 0&&(e[t]=Array.isArray(r)?[...r]:r);}return e}};var R=class{#x;#t;constructor(x){this.#x=x,this.#t=d();}subscribe(x){return this.#t.subscribe(x)}get map(){return this.#x}set map(x){this.#x=x,this.#t.notify(this.#x);}get dimensions(){return s0(b(this.#x))}};var _=class{#x;#t;#i;#e;#r;#s;#n;#o=[0,0];constructor(x){this.#x=x.sprite??null,this.#t=x.position??[0,0],this.#i=x.sprite??null,this.#e=x.position??[0,0],this.#r=x.onTurn,this.#s=x.onInput,this.#n=d();}subscribe(x){return this.#n.subscribe(x)}saveCurrentState(){this.#x=this.#i,this.#t=[...this.#e];}restoreSavedState(){this.#i=this.#x,this.#e=[...this.#t],this.#n.notify();}dispatchOnTurn(){this.#r?.(this.facade);}dispatchOnInput(x){this.#s?.(x);}get sprite(){return this.#i}get position(){return this.#e}set sprite(x){this.#i=x,this.#n.notify();}set position(x){this.#e=[...x],this.#n.notify();}get direction(){return this.#o}setDirection(x){switch(x){case "LEFT":this.#o=[-1,0];break;case "UP":this.#o=[0,-1];break;case "RIGHT":this.#o=[1,0];break;case "DOWN":this.#o=[0,1];break}}get facade(){let x=this;return {get sprite(){return x.sprite},set sprite(e){x.sprite=e;},get position(){return x.position},set position(e){x.position=e;},get direction(){return x.direction}}}};var D=class{#x=0;constructor(){}next(){this.#x++;}get value(){return this.#x}reset(){this.#x=0;}};var E0=i=>{let x=new R(i.map),e=new M(i.filter?.settings??{}),t=new _(i.player),r=new I(i,x),s=new D,o=d();return e.subscribe(()=>{o.notify();}),t.subscribe(()=>{o.notify();}),r.subscribe(()=>{o.notify();}),{player:t,actors:r,gameMap:x,filterUniforms:e,turn:s,subscribe:o.subscribe}};var q=class{controls;lastKeysEvents=new Map;onInput;lastPointerEvent=0;oldTouchX;oldTouchY;pointerId;isSliding=false;constructor(x,e){this.controls=Object.entries(x.controls),this.onInput=e;let t=document.createElement("div");t.style.setProperty("position","absolute"),t.style.setProperty("left","0"),t.style.setProperty("height","0"),t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh"),t.style.setProperty("overflow","hidden"),t.style.setProperty("touch-action","none"),document.body.appendChild(t),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),t.addEventListener("pointerdown",this.handleTouch),t.addEventListener("pointerup",this.handleTouchUp),t.addEventListener("pointerleave",this.handleTouchLeave),t.addEventListener("pointercancel",this.handleTouchLeave),t.addEventListener("pointermove",this.handleTouchMove);}handleTouch=x=>{x.pointerType!=="mouse"&&(this.pointerId=x.pointerId,this.oldTouchX=x.clientX,this.oldTouchY=x.clientY);};handleTouchUp=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding||this.onInput("ACTION"),this.isSliding=false);};handleTouchLeave=x=>{this.pointerId===x.pointerId&&(this.pointerId=void 0,this.isSliding=false);};handleTouchMove=x=>{if(this.pointerId!==x.pointerId)return;let e=x.clientX,t=x.clientY;if(e===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let r=e-this.oldTouchX,s=t-this.oldTouchY,o=x.timeStamp;if(!(Math.abs(r)<30&&Math.abs(s)<30)&&!(o-this.lastPointerEvent<200))if(this.lastPointerEvent=o,this.oldTouchX=e,this.oldTouchY=t,this.isSliding=true,Math.abs(s)>Math.abs(r)){let n=Math.sign(s);this.onInput(n<0?"UP":"DOWN");}else {let n=Math.sign(r);this.onInput(n<0?"LEFT":"RIGHT");}};handleKeydown=x=>{let e=this.controls.find(([o,n])=>n===x.code||n.includes(x.code));if(!e)return;let[t]=e,r=x.timeStamp,s=this.lastKeysEvents.get(x.code);x.repeat&&s&&r-s<200||(this.lastKeysEvents.set(x.code,r),this.onInput(t));}},w0=(i,x)=>new q(i,x);var $0=30,z=class{#x;#t;isOpen=false;#i;#e=[];#r=[];#s;#n;#o=0;#c;#a;#l=0;#f;#u;#m;#p;#h=192;#d=1;#g=2;constructor(x){this.#u=x.colors,this.#m=u(x.messageBackground,x.colors),this.#p=u(x.messageColor,x.colors),this.#s=Math.floor((this.#h-2*this.#d)/8),this.#n=Math.floor(this.#h/(8+this.#g)),this.#c=x.messageInternvalMs,this.#x=document.createElement("canvas"),this.#x.style.setProperty("position","absolute"),this.#x.style.setProperty("box-sizing","border-box"),this.#x.style.setProperty("display","none"),this.#x.style.setProperty("image-rendering","pixelated"),this.#t=this.#x.getContext("2d"),this.#x.width=this.#h,this.#x.height=this.#h,this.#x.classList.add("odyc-message-canvas"),this.#f=new g(`
`,this.#p,this.#u),this.#b(),window.addEventListener("resize",this.#b),document.body.append(this.#x);}#b=()=>{let x=Math.min(window.innerWidth,window.innerHeight),e=(window.innerWidth-x)*.5,t=(window.innerHeight-x)*.5;this.#x.style.setProperty("width",`${x}px`),this.#x.style.setProperty("height",`${x}px`),this.#x.style.setProperty("left",`${e}px`),this.#x.style.setProperty("top",`${t}px`);};open(x){let e=typeof x=="string"?[x]:[...x];if(e.length===0||e[0]?.length===0)return;this.isOpen=true,this.#e=e;let t=this.#e[this.#o];if(t)return this.#r=this.#f.parseText(t,this.#s),this.#x.style.removeProperty("display"),this.#a=requestAnimationFrame(this.#y),new Promise(r=>this.#i=()=>r())}next(){this.#o++;let x=this.#e[this.#o];x?(this.#r=this.#f.parseText(x,this.#s),this.#a=requestAnimationFrame(this.#y)):this.close();}#y=x=>{this.#a=requestAnimationFrame(this.#y),!(x-this.#l<(this.#c||$0))&&this.#v(x);};#v(x){this.#t.clearRect(0,0,this.#x.width,this.#x.height),this.#t.fillStyle=this.#m,this.#t.fillRect(0,0,this.#x.width,this.#x.height),this.#t.fillStyle=this.#p;let e=Math.min(this.#r.length,this.#n),t=e*8+(e-1)*this.#g,r=(this.#x.height-t)*.5;for(let s=0;s<e;s++){let o=this.#r[s];if(!o)continue;let n=o.length*8,a=(this.#x.width-n)*.5,c=r+s*8+s*this.#g;this.#f.draw(this.#t,o,a,c,x);}}close=()=>{this.#o=0,this.#r=[],this.isOpen=false,this.#a&&cancelAnimationFrame(this.#a),this.#x.style.setProperty("display","none"),this.#i?.();};#T(x){return typeof x=="string"?x:this.#u[x]??"black"}},S0=i=>new z(i);var Y=384,f=2,C0=28,$=10,E=8,j=12,F=8,L=2,K=class{#x;#t;#i;isOpen=false;#e=[];#r=0;#s;#n;#o;#c;constructor(x){this.#s=x.colors,this.#n=this.#h(x.dialogBackground),this.#o=this.#h(x.dialogColor),this.#c=this.#h(x.dialogBorder),this.#x=document.createElement("canvas"),this.#x.style.setProperty("position","absolute"),this.#x.style.setProperty("box-sizing","border-box"),this.#x.style.setProperty("display","none"),this.#x.style.setProperty("image-rendering","pixelated"),this.#t=this.#x.getContext("2d"),this.#x.width=Y,this.#x.height=Y,this.#x.classList.add("odyc-prompt-canvas"),this.#m(),document.body.append(this.#x),window.addEventListener("resize",this.#m);}get#a(){let x=C0*8+E*2,e=(this.#x.width-x)*.5,t=Math.floor(Y/15),r=Math.max(Math.ceil(this.#e.length/f),2),s=r*F+j*2+$*(r-1);return {left:e,top:t,width:x,height:s}}async openMenu(x){let e=Object.keys(x),t=e[await this.open(...e)];if(!t||!(t in x))return;let r=x[t];if(r)return typeof r=="function"?r():await this.openMenu(r)}async open(...x){return x.length?(this.#r=0,this.isOpen=true,this.#x.style.setProperty("display","block"),this.#e=x,this.#f(),new Promise(e=>{this.#i=t=>e(t);})):-1}input(x){let e=Math.ceil(this.#e.length/f),t=Math.floor(this.#r/f),r=this.#r-t*f;switch(x){case "LEFT":r=Math.max(0,r-1);break;case "UP":t=Math.max(0,t-1);break;case "RIGHT":r=Math.min(r+1,f-1);break;case "DOWN":t=Math.min(t+1,e-1);break;case "ACTION":this.#l();return}this.#r=Math.min(t*f+r,this.#e.length-1),this.#f();}#l(){this.isOpen=false,this.#x.style.setProperty("display","none"),this.#i?.(this.#r);}#f(){this.#p();let{left:x,top:e,width:t}=this.#a;this.#t.fillStyle=this.#o;let r=Math.ceil(C0/f-f);for(let s=0;s<this.#e.length;s++){let o=this.#e[s]?.slice(0,r);if(!o)continue;let n=Math.floor(s/f),a=s-n*f,c=x+E+a*(t-E*2)/f+(a+1)*F,h=e+j+8*n+n*$;g.text(this.#t,o,c,h);}this.#u();}#u(){let x=Math.floor(this.#r/f),e=this.#r-x*f,{left:t,top:r,width:s}=this.#a,o=t+E+e*(s-E*2)/f+e*F,n=r+j+8*x+x*$;for(let a=0;a<F/2;a++)this.#t.fillRect(o+a,n+a,1,8-2*a);}#m=()=>{let x=Math.min(window.innerWidth,window.innerHeight),e=(window.innerWidth-x)*.5,t=(window.innerHeight-x)*.5;this.#x.style.setProperty("width",`${x}px`),this.#x.style.setProperty("height",`${x}px`),this.#x.style.setProperty("left",`${e}px`),this.#x.style.setProperty("top",`${t}px`);};#p(){this.#t.clearRect(0,0,this.#x.width,this.#x.height),this.#t.fillStyle=this.#c;let{left:x,top:e,height:t,width:r}=this.#a;this.#t.fillRect(x-L,e-L,r+L*2,t+L*2),this.#t.fillStyle=this.#n,this.#t.fillRect(x,e,r,t);}#h(x){return typeof x=="string"?x:this.#s[x]??"black"}},A0=i=>new K(i);var Z=class{canvas;#x=24;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(x){this.screenWidth=x.screenWidth,this.screenHeight=x.screenHeight,this.cellWidth=x.cellWidth,this.cellHeight=x.cellHeight,this.colors=x.colors,this.background=x.background,this.canvas=document.createElement("canvas"),this.canvas.width=this.cellWidth*x.screenWidth*this.#x,this.canvas.height=this.cellHeight*x.screenHeight*this.#x,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-renderer-canvas");let e=this.canvas.getContext("2d");if(!e)throw new Error("failled to access context of the canvas");this.ctx=e,this.#t(),document.body.append(this.canvas),window.addEventListener("resize",this.#t);}#t=()=>{let x=this.canvas.width<this.canvas.height?"vertical":"horizontal",e=Math.min(window.innerWidth,window.innerHeight),t=x==="horizontal"?e:e/this.canvas.height*this.canvas.width,r=x==="vertical"?e:e/this.canvas.width*this.canvas.height,s=(window.innerWidth-t)*.5,o=(window.innerHeight-r)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${r}px`),this.canvas.style.setProperty("left",`${s}px`),this.canvas.style.setProperty("top",`${o}px`);};render(x,e,t){this.clear();let r=false;for(let s of e)s.foreground&&s.position[0]===x.position[0]&&s.position[1]===x.position[1]?(this.#i(x,t),this.#i(s,t),r=true):this.#i(s,t);r||this.#i(x,t);}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.background!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*this.#x,this.screenHeight*this.cellHeight*this.#x));}#i(x,e){if(x.sprite===void 0||x.sprite===null||x.visible===false||!e.isOnScreen(x.position))return;let[t,r]=x.position,[s,o]=e.position,n=(t-s)*this.cellWidth,a=(r-o)*this.cellHeight;if(n+this.cellWidth<0||a+this.cellHeight<0||n>this.screenWidth*this.cellWidth||a>this.screenHeight*this.cellHeight)return;let c=x.sprite;if(typeof c=="number"||c.length===1){let l=u(c,this.colors);if(!l)return;this.ctx.fillStyle=l,this.ctx.fillRect(Math.floor(n)*this.#x,Math.floor(a)*this.#x,this.cellWidth*this.#x,this.cellHeight*this.#x);return}let h=b(c);for(let l=0;l<this.cellHeight;l++)for(let p=0;p<this.cellWidth;p++){let m=h[l]?.charAt(p);if(!m)continue;let S=u(m,this.colors);S&&(this.ctx.fillStyle=S,this.ctx.fillRect(Math.floor(n+p)*this.#x,Math.floor(a+l)*this.#x,this.#x,this.#x));}}},I0=i=>new Z(i);var M0={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},v=Object.values(M0).flatMap(i=>[...i]),O=v.reduce((i,x)=>({...i,[x.name]:x.defaultValue}),{}),j0=(i,{noiseAmount:x})=>{let e=i.createWaveShaper(),t=44100,r=new Float32Array(t),s=Math.PI/180;for(let o=0;o<t;o++){let n=o*2/t-1;r[o]=(3+Math.random()*x)*n*20*s/(Math.PI+Math.random()*x*Math.abs(n));}return e.curve=r,e.oversample="4x",{input:e,output:e}},K0=(i,{attackTime:x,sustainTime:e,sustainPunch:t,decayTime:r})=>{let s=i.createGain(),o=i.currentTime;return s.gain.setValueAtTime(0,o),s.gain.linearRampToValueAtTime(1-t,o+x),s.gain.setValueAtTime(1,o+x),s.gain.linearRampToValueAtTime(1-t,o+x+e),s.gain.linearRampToValueAtTime(0,o+x+e+r),{input:s,output:s}},Z0=(i,{highPassCutoff:x,highPassResonance:e})=>{let t=i.createBiquadFilter();return t.type="highpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},Q0=(i,{lowPassCutoff:x,lowPassResonance:e})=>{let t=i.createBiquadFilter();return t.type="lowpass",t.frequency.value=x,t.Q.value=e,{input:t,output:t}},J0=(i,x,e)=>Math.min(Math.max(i,x),e),xx=(i,x)=>Math.round(i*10**x)/10**x,ex=["sine","sawtooth","square","triangle"],tx=M0.pitch[0].max,ix=(i,x,{waveForm:e,frequency:t,pitchDelta:r,pitchDuration:s,pitchDelay:o})=>{let n=x*o,a=(x-n)*s,c=i.createOscillator();return c.type=ex[e]??"sine",c.frequency.setValueAtTime(t,i.currentTime),c.frequency.linearRampToValueAtTime(t,i.currentTime+n),c.frequency.linearRampToValueAtTime(J0(0,t+r,tx),i.currentTime+n+a),{input:c,output:c,start:()=>c.start(),stop:h=>c.stop(h)}},rx=(i,{phaserBaseFrequency:x,phaserLfoFrequency:e,phaserDepth:t})=>{let r=i.createBiquadFilter();r.type="allpass",r.frequency.value=x;let s=i.createOscillator();s.type="sine",s.frequency.value=e;let o=i.createGain();return o.gain.value=t,s.connect(o),o.connect(r.frequency),{input:r,output:r,start:()=>s.start(),stop:n=>s?.stop(n)}},R0=(i,x,e)=>{let t=i.createOscillator(),r=i.createGain();return t.frequency.value=e,r.gain.value=x,t.connect(r),{input:t,output:r,start:()=>t.start(),stop:s=>t.stop(s)}},sx=(i,{tremoloDepth:x,tremoloRate:e})=>R0(i,x,e),nx=(i,{vibratoDepth:x,vibratoRate:e})=>R0(i,x,e),ox=(i,{volume:x})=>{let e=i.createGain();return e.gain.value=x,{input:e,output:e}},_0=(i,x,e)=>{let t=Object.assign({},O,i),r=t.attackTime+t.sustainTime+t.decayTime,s=ix(x,r,t),o=j0(x,t),n=K0(x,t),a=nx(x,t),c=sx(x,t),h=Q0(x,t),l=Z0(x,t),p=rx(x,t),m=ox(x,t);a.output.connect(s.input.frequency),c.output.connect(n.input),s.output.connect(o.input),o.output.connect(p.input),p.output.connect(h.input),h.output.connect(l.input),l.output.connect(n.input),n.output.connect(m.input),m.output.connect(e);let S=[a,c,s,p,h,n];return new Promise(F0=>{S.forEach(e0=>{e0.start?.(),e0.stop?.(x.currentTime+r);}),s.output.onended=()=>F0();})},Q=i=>{let x={...O},e=i.searchParams.get("fx");if(!e)return x;let t=decodeURI(e).split(",");for(let r=0;r<v.length;r++){let s=v[r]?.name,o=t[r];s&&o&&!isNaN(Number(o))&&(x[s]=Number(o));}return x};var ax=class{seed;#x;#t;#i;#e;constructor(i){this.seed=i??Date.now(),this.#x=this.seed&4294967295,this.#t=362436069,this.#i=521288629,this.#e=88675123;for(let x=0;x<32;x++)this.#r();}#r(){let i=this.#x^this.#x<<11&4294967295;return this.#x=this.#t,this.#t=this.#i,this.#i=this.#e,this.#e=this.#e^this.#e>>>19^(i^i>>>8),this.#e+2147483648}number(i,x){return i===void 0?(i=0,x=1):x===void 0&&(x=i,i=0),i+(x-i)*this.#r()/4294967295}boolean(i=.5){return this.number(0,1)<i}fromArray(i){return i[Math.floor(this.number(0,i.length))]}},cx=i=>(v.forEach(x=>{let e=i[x.name];if(x.type==="range"&&e){let t=x.step.toString().split(".")[1]?.length??0;i[x.name]=xx(e,t);}}),Object.assign({},O,i)),J=(i,x)=>cx(i(new ax(x))),w={DEFAULT:()=>({}),PICKUP:i=>({...i.boolean()?{pitchDelta:i.number(100,500),pitchDuration:0,pitchDelay:i.number(0,.7)}:{},waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,.8),sustainTime:i.number(.05,.2),decayTime:i.number(.1,.3),frequency:i.number(900,1700)}),LASER:i=>{let x=i.number(100,1300);return {waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,.8),sustainTime:i.number(.05,.1),decayTime:i.number(0,.2),frequency:x,pitchDelta:i.number(-x,-100),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)])}},JUMP:i=>({waveForm:i.fromArray([1,2]),sustainPunch:i.number(0,.8),sustainTime:i.number(.2,.5),decayTime:i.number(.1,.2),frequency:i.number(100,500),pitchDelta:i.number(200,500),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)])}),FALL:i=>{let x=i.number(80,500);return {waveForm:i.fromArray([1,2,3]),sustainPunch:0,sustainTime:i.number(.2,.5),decayTime:i.number(.2,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:i.number(0,.2),vibratoRate:i.number(8,18),vibratoDepth:i.number(10,30),tremoloRate:i.number(5,18),tremoloDepth:i.number(0,1)}},POWERUP:i=>({waveForm:i.fromArray([0,1,2,3]),sustainPunch:i.number(0,1),sustainTime:i.number(.2,.5),decayTime:i.number(.1,.5),frequency:i.number(200,1e3),pitchDelta:i.number(100,300),pitchDuration:1,pitchDelay:i.fromArray([0,i.number(0,.3)]),vibratoRate:i.number(10,18),vibratoDepth:i.number(50,100)}),EXPLOSION:i=>{let x=i.number(200);return {waveForm:i.fromArray([0,1,2,3]),volume:.3,sustainPunch:i.number(0,.3),sustainTime:i.number(.4,1.3),decayTime:i.number(.1,.5),frequency:x,pitchDelta:-x,pitchDuration:1,pitchDelay:i.number(.3),vibratoRate:i.number(0,70),vibratoDepth:i.number(0,100),tremoloRate:i.number(0,70),tremoloDepth:i.number(0,1),phaserDepth:i.number(300,1e3),noiseAmount:i.number(300,500)}},BLIP:i=>({waveForm:i.fromArray([0,1,2,3]),sustainTime:i.number(.02,.1),decayTime:i.number(0,.04),frequency:i.number(600,3e3)}),HIT:i=>{let x=i.number(20,500);return {waveForm:i.fromArray([0,1,2,3]),sustainTime:i.number(.01,.03),sustainPunch:i.number(.5),decayTime:i.number(0,.2),frequency:x,pitchDelta:i.number(-x,-x*.2),noiseAmount:i.number(100)}},FART:i=>{let x=i.number(30,150);return {waveForm:1,volume:.7,sustainPunch:i.number(0,.2),sustainTime:i.number(.1,.5),decayTime:i.number(.3,.5),frequency:x,pitchDelta:-x/2,pitchDuration:1,pitchDelay:.1,vibratoRate:i.number(8,18),vibratoDepth:i.number(10,30),tremoloRate:i.number(35,70),tremoloDepth:i.number(.6,1),lowPassCutoff:x*10,lowPassResonance:10,noiseAmount:i.number(0,30)}},RANDOM:i=>{let x={...O};for(let e=0;e<v.length;e++){let t=v[e];t&&(t.type==="range"?x[t.name]=i.number(t.min,t.max):t.type==="radio"&&(x[t.name]=i.fromArray(t.options.map(r=>r.value))));}return x}};var x0=class{#x;#t;#i=false;constructor(x){this.#x=new AudioContext,this.#t=this.#x.createGain(),this.#t.gain.value=x.volume,this.#t.connect(this.#x.destination);}async play(...x){if(this.#i)return;this.#i=true;let e=this.#e(...x);return _0(e,this.#x,this.#t).then(()=>{this.#i=false;})}#e(...x){let[e,t]=x;return typeof e!="string"?e:k(e)?Q(new URL(e)):e in w?J(w[e],t):{}}},D0=i=>new x0(i),hx=(...i)=>{let[x,e]=i;return k(x)?Q(new URL(x)):x in w?J(w[x],e):{}};var fx=i=>{let x=Object.assign({},i0,i),e=E0(x),t=D0(x),r=t0(x),s=I0(x),o=m0(x),n=A0(x),a=S0(x),c=v0(s.canvas,x.filter),h=p0({gameState:e,messageBox:a,camera:r}),l=o0(()=>{c?.setUniforms(e.filterUniforms.get()),r.update(e.player.position,e.gameMap.dimensions),s.render(e.player,e.actors.get(),r),e.actors.handleScreenEvents(r),c?.render();},60),p=P0({gameState:e,soundPlayer:t,dialog:o,ender:h});return w0(x,m=>{n.isOpen?n.input(m):a.isOpen?m==="ACTION"&&a.next():o.isOpen?m==="ACTION"&&o.next():(m!=="ACTION"&&p.update(m),e.player.dispatchOnInput(m));}),e.subscribe(l),x.title&&a.open(x.title),l(),T0(e,o,n,t,h,a)};

    exports.createGame = fx;
    exports.createSound = hx;

    return exports;

})({});

    const {createGame, createSound} = odyc
//startofthegame
const game = createGame({
  filter: {
    name: "crt",
    settings: {
      warp: 0.8, // Screen curvature (0 to 1)
      lineIntensity: 0.3, // Line opacity
      lineWidth: 0.5, // Line thickness
      lineCount: 100, // Number of scanlines
    },
  },
  title: ["NH", "Workplace Safety"],
  player: {
    sprite: `
              ........
              ...777..
              ..77777.
              ..77777.
              ..70707.
              .7577757
              ...555..
              ..77.77.
              `,
    position: [1, 1],
  },
  templates: {
    // robot
    h: {
      sprite: `
              ...555..
              ..56565.
              ..55555.
        ..11111.
              `,
      dialog: `oh yeah! its helmet!
        |
        no more =NO HELMET!=`,
      onCollide(target) {
        target.remove();
        game.player.sprite = `
        ........
              ...555..
              ..56565.
              ..55555.
              ..70707.
          .7577757
              ...555..
              ..77.77.
  `;
      },
    },

    w: {
      sprite: `
              111111111.
              111211211.
              .12.22.211
              .12.22.211
              .12.22.21.
              .11211211.
              .11.11.11.
              `,
    },
    m: {
      sprite: `
              444444444.
              444944944.
              .49.99.944
              .49.99.944
              .49.99.94.
              .44944944.
              .44.44.44.
              `,
    },

    1: {
      sprite: `4444444444\n4.........\n4.........\n4.........\n4.........\n4.........\n4.........\n4.........`,
      solid: false,
      async onEnter(target) {
        await checkHelmet(target, game, { x: 3, y: 2 });
      },
    },
    2: {
      sprite: `4444444444\n.........4\n.........4\n.........4\n.........4\n.........4\n.........4\n.........4`,
      solid: false,
      async onEnter(target) {
        await checkHelmet(target, game, { x: 4, y: 2 });
      },
    },

    3: {
      sprite: `4.........\n4.........\n4.........\n4.........\n4.........\n4.........\n4.........\n4444444444`,
      solid: false,
      async onEnter(target) {
        await checkHelmet(target, game, { x: 3, y: 3 });
      },
    },
    4: {
      sprite: `.........4\n.........4\n.........4\n.........4\n.........4\n.........4\n.........4\n4444444444`,
      solid: false,
      async onEnter(target) {
        await checkHelmet(target, game, { x: 4, y: 3 });
      },
    },

    d: {
      sprite: `
              5........5
              4444444444
              4...44...4
              4444944444
              4...44...4
              4444444444
              4........4
              `,
      dialog: "Need a key...",
      onEnter(target) {
        game.setAll("d", {
          sprite: `
              5........5
              4........4
              4........4
              4........4
              4........4
              4........4
              4........4
              `,
        });
      },
      onLeave(target) {
        game.setAll("d", {
          sprite: `
              5........5
              4444444444
              4...44...4
              4444944444
              4...44...4
              4444444444
              4........4
              `,
        });
      },
    },

    k: {
      sprite: `
              ........
              ........
              .....555
              .....5.5 
              555555.5
              5.5..5.5
              5....555
              ........
              `,
      onCollide(target) {
        target.remove();
        game.setAll("d", {
          solid: false,
          dialog: null,
        });
      },
    },
    // wall
    x: {
      sprite: `
              666.666269
              5996669966
              6966266666
              5966699696
              6666699566
              5656699666
              56.6596669
              6966555669
              `,
    },

    // ending
    e: {
      sprite: 0,
      visable: false,
      solid: false,
      end: ["Wasted"],
    },
  },
  map: `
      xxxxxxxx
      x.....kx
      x..12..x
      x..34..x
      x......x
      xwmwmwdx
      xh.....x
      xxxxxxxx
      `,
  background: 0,
  dialogBackground: 1,
  dialogBorder: 0,
  dialogColor: 0,

  cellWidth: 10,
  cellHeight: 8,
  // screenWidth: 4,
  // screenHeight: 4,
  cameraWidth: 1,
  cameraHeight: 1,
});

const checkHelmet = async (target, game, endPos) => {
  const helmetWear = !game.getCell(1, 6).isOnScreen;
  const falseAlert = Math.floor(Math.random() * 9) > 5;
  if (helmetWear && falseAlert) {
    await game.openMessage("Wait...");
  }
  if (!helmetWear || falseAlert) {
    await game.openMessage("NO HELMET!");
    game.player.sprite = `
        ....4.....
        ..444.....
        444444..4.
        .444444444
        ..4444444.
        .44..444..
        .....44...
        .....4....
        `;
    await game.playSound("EXPLOSION");
    game.addToCell(endPos.x, endPos.y, "e");
  }
};

//endofthegame
    
  </script>
</body>
</html>
